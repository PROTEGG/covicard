<html>
<head>
    <title>COVICARD - appfreie Visitenkarte für Kontaktnachverfolgung</title>
    <meta name="theme-color" content="black">
    <meta http-equiv="content-type" content="text/html; charset=utf-8"> 
  
   <!-- <link rel="icon" type="image/png" href="/IMG_0588.PNG" sizes="32x32"> -->
    <meta name="description" content="Corona beim Weggehen: Identifizieren - kontaktlos, hygienisch, automatisch, app-los, internetfrei und ANONYM!"/>
	<meta name="robots" content="noindex"/>


	<meta http-equiv="X-UA-Compatible" content="ie=edge">

	<meta name="application-name" content="COVICARD">
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-title" content="covicard\r\nTagebuch">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000000">
	<meta name="apple-mobile-web-app-status-bar-style" content="#000000">
	<meta name="msapplication-config" content="browserconfig.xml?v=210502094419">
	<link rel="apple-touch-icon" sizes="57x57" href="apple-touch-icon-57x57.png?v=210502094419">
	<link rel="apple-touch-icon" sizes="60x60" href="apple-touch-icon-60x60.png?v=210502094419">
	<link rel="apple-touch-icon" sizes="72x72" href="apple-touch-icon-72x72.png?v=210502094419">
	<link rel="apple-touch-icon" sizes="76x76" href="apple-touch-icon-76x76.png?v=210502094419">
	<link rel="apple-touch-icon" sizes="114x114" href="apple-touch-icon-114x114.png?v=210502094419">
	<link rel="apple-touch-icon" sizes="120x120" href="apple-touch-icon-120x120.png?v=210502094419">
	<link rel="apple-touch-icon" sizes="144x144" href="apple-touch-icon-144x144.png?v=210502094419">
	<link rel="apple-touch-icon" sizes="152x152" href="apple-touch-icon-152x152.png?v=210502094419">
	<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon-180x180.png?v=210502094419">
	<link rel="icon" type="image/png" href="android-chrome-36x36.png?v=210502094419" sizes="36x36">
	<link rel="icon" type="image/png" href="android-chrome-48x48.png?v=210502094419" sizes="48x48">
	<link rel="icon" type="image/png" href="android-chrome-72x72.png?v=210502094419" sizes="72x72">
	<link rel="icon" type="image/png" href="android-chrome-96x96.png?v=210502094419" sizes="96x96">
	<link rel="icon" type="image/png" href="android-chrome-144x144.png?v=210502094419" sizes="144x144">
	<link rel="icon" type="image/png" href="android-chrome-192x192.png?v=210502094419" sizes="192x192">
	<link rel="icon" type="image/png" href="favicon-16x16.png?v=210502094419" sizes="16x16">
	<link rel="icon" type="image/png" href="favicon-32x32.png?v=210502094419" sizes="32x32">
	<link rel="icon" type="image/png" href="favicon-96x96.png?v=210502094419" sizes="96x96">
	<link rel="shortcut icon" type="image/x-icon" href="favicon.ico?v=210502094419">
	<meta name="msapplication-TileImage" content="mstile-150x150.png?v=210502094419">
	<meta name="msapplication-square70x70logo" content="mstile-70x70.png?v=210502094419">
	<meta name="msapplication-square150x150logo" content="mstile-150x150.png?v=210502094419">
	<meta name="msapplication-wide310x150logo" content="mstile-310x150.png?v=210502094419">
	<meta name="msapplication-square310x310logo" content="mstile-310x310.png?v=210502094419">
	<link href="apple-touch-startup-image-320x460.png?v=210502094419" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)" rel="apple-touch-startup-image">
	<link href="apple-touch-startup-image-640x920.png?v=210502094419" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">
	<link href="apple-touch-startup-image-640x1096.png?v=210502094419" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">
	<link href="apple-touch-startup-image-748x1024.png?v=210502094419" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 1) and (orientation: landscape)" rel="apple-touch-startup-image">
	<link href="apple-touch-startup-image-750x1024.png?v=210502094419" media="" rel="apple-touch-startup-image">
	<link href="apple-touch-startup-image-750x1294.png?v=210502094419" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image">
	<link href="apple-touch-startup-image-768x1004.png?v=210502094419" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 1) and (orientation: portrait)" rel="apple-touch-startup-image">
	<link href="apple-touch-startup-image-1182x2208.png?v=210502094419" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" rel="apple-touch-startup-image">
	<link href="apple-touch-startup-image-1242x2148.png?v=210502094419" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" rel="apple-touch-startup-image">
	<link href="apple-touch-startup-image-1496x2048.png?v=210502094419" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" rel="apple-touch-startup-image">
	<link href="apple-touch-startup-image-1536x2008.png?v=210502094419" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" rel="apple-touch-startup-image">
	<link rel="manifest" href="manifest.json?v=210502094419" />

</head>

<body bgcolor=black>
    
<script>    

//*******************************************
//*******wait and click "Scanner-Button"*****
//*******************************************


function promiser() {
  return new Promise(resolve => {
    setTimeout(() => {
      resolve('resolved');
    }, 3000);
  });
}

async function clickScannerButton() {
  const result = await promiser();
  try{
      var ScannerButton=document.getElementById("scannerButton"); 
      ScannerButton.click();
      console.log("klick");
  }
  catch{
      console.log("zu spät");
  }
}

clickScannerButton();


function insertFormData() {
                var x = document.forms["suche"]["data"].value;
                
                var y = x;
                
                var numberOfData    = localStorage.length;   
                numberOfData        = numberOfData+1;
                var key             ='contact'+numberOfData;
 
                
                var splitter        = y.toString().split(" ");
                var fn              = splitter[0];
                
                var numberOfData    = localStorage.length;   
                numberOfData        = numberOfData+1;
                var key             ='contact'+numberOfData;
            
                var d               = new Date();
                var actualDate      = d.toLocaleDateString([], {day: '2-digit', month: '2-digit', year: 'numeric'});
                var actualTime      = d.toLocaleTimeString('de-DE');
            
                var name            = fn+'-'+actualDate+'-'+actualTime+'-'+x; 
                   

  localStorage.setItem(key, name);
}
 
 function securityConfirm() {
   if (confirm('ACHTUNG!\n\rDATEN WERDEN UNWIDERBRINGLICH GELOESCHT. \n\r Wirklich löschen?')) {
    localStorage.clear();
   }
  } 

</script>
    
    <a  href="menue.htm"><img src="menuebutton.PNG" width = 100dp   padding=50px style="right: 2.9em; top: 3em; position: absolute;"></a>
<button  onclick="securityConfirm()" style="right: 3em; top: 16em; position: absolute; background-color: black; border:0px; width: 100dp"><img src="deletebutton.png" width=100dp></button>
<button  onclick="downloadFile()" style=" right: 3em; top: 24em; position: absolute;background-color: black; border:0px; width: 100dp"><img src="savebutton.png" width=100dp></button>




<table align=center width=100%>
<tr height =50>
    <td align=center style="font-family: Arial; color: white; font-size: 80"> 
    <br>
    <b>COVICARD</b><div style="font-family: Arial; font-size: 40; color: #FF6A00">   Tagebuch (BETA) <br><br></div>
    <div style="font-family: Arial; font-size: 40; color: white; ">solidarisch, aber nicht zentral<br><br></div>
    </td>
</tr>
</table>




<table align=center width=100%>
    
    <tr align=center valign=center>
        <td width= 700px align=center valign=center >
      
       <!-- <p style="font-size:40px; font-family: Arial; color: orange"><br><br>Card scannen!</p> -->
        <div align=center id="qr-reader"  style="vertical-align: middle; justify-content: center; max-width:500; max-height:600px; overflow: hidden; "></div>
       
     
            <div align=center id="controllElementes"  style="vertical-align: middle; horizontal-align: middle; border: none"></div>  
        </td></tr>
  
    
    

     <tr align=center>
        <td align=center valign=top border=none>
        
         <div align=center style="font-family: Arial; font-size: 20px; color: white;"><br><br> </div>
         
        <div align=center style="font-family: Arial; font-size: 20px; color: white;" id="qr-reader-results"></div>
       
        
        
        </td>
    </tr>
   
   
   <tr><td height= 5px></td></tr>
   
    <tr><td align=center>
        
        
       <form name="suche" id=sender action="codecreatedDiary.php" onsubmit="return insertFormData()" method="post"><br> 
       <input size="30" style="font-size:40px;background-color: black; color: #d3d3d3; border: 5px solid #515151;
  border-radius: 0.5em; text-align: center" type="text" id=suche name="data" placeholder=" Vorname Nachname E-Mail">
<br><br><br>
<button id=schrift3 type="submit" form="sender" style="font-size:40px;	border: 2px solid black; border-radius: 0.5em; background-color: #FF6A00; color: white" >VON HAND EINTRAGEN</button><br><br>

</form> 
        
        
        
        </td></tr><tr><td height= 20px></td></tr>
    <tr align=center>
        <td align=center valign=top border=none>
        
        
       <div id="servus" style="overflow: scroll;  overflow-x: hidden;; height:1300px; width: 700px"></div>
        
        
        </td>
    </tr>
    <tr><td align=center ><div id="selector"></div></td></tr>
    <tr><td height=20px></td></tr>
   
</table>

<a id="downloader" href="" download="myContactDetails.csv" style="display: none;"></a>
  
    
<script src="html5-qrcode.min2.js?$$REVISION$$"></script>   


<script>

//*******************************************
//*******check if it is first visit, and, if so, alert instruction *****
//*******************************************

var c = localStorage.getItem("cautionInformatione");
if (c==null){
var flag=true;
localStorage.setItem("cautionInformatione", flag);
  
    alert("1. Kamerazugriff erlauben.\n\n2. Scanner starten (Button \"SCANNER\").\n\n3. QR-Code in den \r\n  hellen Bereich des Suchers zirkeln.\r\n\r\n4. Gerät erfasst Code automatisch  und trägt Ihren Kontakt \r\n  automatisch im Tagebuch ein. \r\n\r\n\r\n LÖSCHEN SIE NICHT IHRE BROWSERDATEN!\r\n\r\n Die Kontakte werden ausschließlich auf Ihrem Gerät gespeichert. \r\n Löschen Sie die Browserdaten, löschen Sie ohne Vorwarnung auch Ihre Tagebuchdaten. ");
}

//*******************************************
//*******function to sanitize user input tp prevent XSS-Attacks *****
//*******************************************

var sanitizeHTML = function (str) {
	return str.replace(/[^\w. ]/gi, function (c) {
		return '&#' + c.charCodeAt(0) + ';';
	});
};

//*******************************************
//*******call function displayer() which displays previour inserted diary data*****
//*******************************************

 displayer(); 

    function docReady(fn) {
        // see if DOM is already available
        if (document.readyState === "complete"
            || document.readyState === "interactive") {
            // call on next available tick
            setTimeout(fn, 1);
        } else {
            document.addEventListener("DOMContentLoaded", fn);
        }
    }

    docReady(function () {
       // document.getElementById("scannerButton").click();
        var resultContainer = document.getElementById('qr-reader-results');
        var lastResult ="kdfskdlfdfjh" 
        var countResults = 0;
        var comperator;
        var compera;
        
        function onScanSuccess(qrCodeMessage) {
     
            
            comperator  = qrCodeMessage;
            compera = lastResult;
            
            comperator  = comperator.substring(4, 8);
            compera = compera.substring(4, 8);
     
            
            if (comperator != compera) {
                
                var code ="";
                var firstname ="";
                var controller ="";
                var container ="";
                var firstSplitter ="";
                var jux ="";
                var secondSplitter = "";
                
                lastResult        = qrCodeMessage;
                
                 container       = qrCodeMessage;
                 firstSplitter   = container.toString().split("/");
                if(firstSplitter[2]==null){firstSplitter[2]="hello";}
                
              
                jux              = qrCodeMessage;
                secondSplitter   = jux.toString().split("-");
                if(secondSplitter[0]!=null){firstname=secondSplitter[0]; code=secondSplitter[1];} else{firstname='Anonymus'; code=qrCodeMessage;}
                
                document.getElementById("qr-reader-results").innerHTML = firstname+firstSplitter[2];
                
                var numberOfData    = localStorage.length;   
                numberOfData        = numberOfData+1;
                var key             ='contact'+numberOfData;
                
               
                var d               = new Date();
                var actualDate      = d.toLocaleDateString([], {day: '2-digit', month: '2-digit', year: 'numeric'});
                var actualTime      = d.toLocaleTimeString('de-DE');
            
                //document.getElementById("qr-reader-results").innerHTML = secondSplitter[0];
                if (firstSplitter[2].valueOf() == new String("app.luca-app.de").valueOf()){
                    
                    qrCodeMessage='luca(R) Kontaktcode-'+actualDate+'-'+actualTime+'-'+firstSplitter[4]; 
                   
                }
                else{
                   
                
                    qrCodeMessage=firstname+'-'+actualDate+'-'+actualTime+'-'+code;
                    
                }
                
                
                
                localStorage.setItem(key, qrCodeMessage);
                displayerS();
               
            }
 





        }

        var html5QrcodeScanner = new Html5QrcodeScanner(
            "qr-reader", { fps: 10, qrbox: 250 });
        html5QrcodeScanner.render(onScanSuccess);
    });



function saver(cardContent){
    
  
}

//****************************************
//displayer: Display all contact-data which are saved to localStorage
//****************************************
 
function displayer(){
 

 
var numberOfData1    = localStorage.length;  
var i;
var iteratedItem1;
var result1; 

for(i=numberOfData1; i > 0; i--){
  

iteratedItem1 = 'contact'+i;

  
  var limiter           = numberOfData1-5;
  var cardContent       = localStorage.getItem(iteratedItem1);
  var cardConString     = String(cardContent);
  var cardConStringB    = cardConString;


  
  
  if(i>limiter){
  var cardContentA = cardConString.split("-");
  var timeToStr = cardContentA[2];
  if (cardContentA[0]==null){unSanFirst="Anonymus"}else{unSanFirst=cardContentA[0].toString()}
  if (cardContentA[3]==null){unSanCode="Karte enthiehlt keinen Code."}else{unSanCode=cardContentA[3].toString()}
  if (cardConStringB==null){cardConStringB="Karte enthielt keinen Code."}else{cardConStringB=cardConStringB.toString()}
  
  var tablecont         = '<br><table  style="width: 680; font-family: Arial; font-size: 30; color: white; background-color: black; padding: 10px; border-radius: 10px;"><tr><td>Vorname: </td><td width=10px></td><td><b>' + sanitizeHTML(unSanFirst) + '</b></td></tr><tr><td>Datum: </td><td width=10px></td><td>'+cardContentA[1]+'</td></tr><tr><td>Uhrzeit: </td><td width=10px></td><td>'+cardContentA[2]+'</td></tr><tr><td style="vertical-align: top;">Kontakt-Code: </td><td width=10px></td><td style="word-break: break-word; width: 500px; vertical-align: top;">'+sanitizeHTML(unSanCode)+'</td></tr></table><br><br>';
  }else{
      
   var tablecont         = '<br><table  style="width: 680; font-family: Arial; font-size: 30; color: white; background-color: black; padding: 10px; border-radius: 10px;"><tr><td>Vorname: </td><td width=10px></td><td><b>'+'geschwärzt'+'</b></td></tr><tr><td>Datum: </td><td width=10px></td><td>'+'geschwärzt'+'</td></tr><tr><td>Uhrzeit: </td><td width=10px></td><td>'+'geschwärzt'+'</td></tr><tr><td style="vertical-align: top;">Kontakt-Code: </td><td width=10px></td><td style="word-break: break-word; width: 500px; vertical-align: top;">'+sanitizeHTML(cardConStringB)+'</td></tr></table><br><br>';   
  }
  
  div=document.createElement("div");
  div.innerHTML=tablecont;
  elmnt = document.getElementById("servus");
  elmnt.appendChild(div);
  


  }

    
}


function displayerS(){
 
  var numberOfData1    = localStorage.length;  
  var iteratedItem1;
  var result1; 
  iteratedItem1         = 'contact'+numberOfData1;
  var cardContent       = localStorage.getItem(iteratedItem1);
  var cardConString     = cardContent;//String(cardContent);
  var weitergeber       = cardConString;
  var cardContentA      = cardConString.split("-");
  
  if (cardContentA[0]==null){unSanFirst="Anonymus"}else{unSanFirst=cardContentA[0].toString()}
  if (cardContentA[3]==null){unSanCode="Karte enthielt keinen Code."}else{unSanCode=cardContentA[3].toString()}
  if (cardContentA[0].toString()=='luca(R) Kontaktcode'){
      var lucaCodeLength=cardContentA.length;
      unSanCode = cardContentA[3].toString();
      if (lucaCodeLength>4){
          var y;
          for (y=4; y<lucaCodeLength; y++){
            unSanCode = unSanCode+'-'+cardContentA[y].toString();  
          }
      }
  }
      
      
    
  var tablecont         = '<br><table  style="width: 680; font-family: Arial; font-size: 30; color: white;  background-color: #FF6A00; padding: 10px; border-radius: 10px;"><tr><td>Vorname: </td><td width=10px></td><td ><b>'+sanitizeHTML(unSanFirst)+'</b></td></tr><tr><td>Datum: </td><td width=10px></td><td>'+cardContentA[1]+'</td></tr><tr><td>Uhrzeit: </td><td width=10px></td><td>'+cardContentA[2]+'</td></tr><tr><td style="vertical-align: top;">Kontakt-Code: </td><td width=10px></td><td style="word-break: break-word; width: 500px; vertical-align: top; ">'+sanitizeHTML(unSanCode)+'</td></tr></table><br><br>';
  
                div                   =document.createElement("div");
                div.innerHTML         =tablecont;
                elmnt                 = document.getElementById("servus");
                elmnt.insertBefore(div, elmnt.childNodes[0]);
                
        var numberOfFive    = numberOfData1-5;
        if(numberOfFive>0){
        var itemToE         = 'contact'+numberOfFive; 
        var contentOfCell   = localStorage.getItem(itemToE);
        var contentOfCellString = contentOfCell;
        //document.getElementById("qr-reader-results").innerHTML = contentOfCell;
        var itemE;
        
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
        var newContent="";
        var newContent=xhttp.responseText;
        localStorage.setItem(itemToE, newContent);
        console.log(newContent);
        }
        };
        
        xhttp.open("POST", "dhfv.php", true);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        data="pqny="+contentOfCellString;
        datarep= data.replace("+", "2%B");
        console.log(datarep);
        xhttp.send(datarep); 
        
        
        }
  
}
   
  var oLastUrl = null;
 
function downloadFile()
{
    var oBlob, dlLink;
  
    if (oLastUrl == null)
    {
        window.URL.revokeObjectURL(oLastUrl);
        oLastUrl = null;
    }
     
  
    var rower = ["Banana", "Datum; Uhrzeit; verschluessele Kontaktdaten\n\r\n\r"];
    var numberOf    = localStorage.length;  
    var z;
    var newItem1;
    var o=1;
    var limiterTwo = numberOf - 5;


    for(z=1; z <= numberOf; z++){
   
    o++;
    newItem1 = 'contact'+z;

  
    var Content       = localStorage.getItem(newItem1);
    var ConString     = String(Content);
    

    if(numberOf >5 && z>limiterTwo){ 
        var ContentA = ConString.split("-");
        rower[o] = (ContentA[1]+'; '+ContentA[2]+'; '+ContentA[3]+'\r\n');
    }else{
        rower[o] = ('geschwaerzt; geschwaerzt; '+ConString+'\r\n');
    }
    
    
    
    
    
    
    
    document.getElementById("qr-reader-results").innerHTML= o+rower[o]; 
    
        
        
        
        
    }
   
  
   
   rower.shift();
  
   
    oBlob = new Blob(rower, { type: "text/comma-separated-values" });
     
    if (window.navigator.msSaveBlob)
    {
        window.navigator.msSaveBlob(oBlob, "myContactHistory.csv");
    }
    else
    {
        dlLink = document.getElementById("downloader");
         
        oLastUrl = window.URL.createObjectURL(oBlob);
         
        dlLink.href = oLastUrl;
    
        dlLink.click();
    }
}   
       


 
 
    
</script>

<br><br>
<table width=100%>
         <tr height = 200><td></td>
             <td width=80% id=schrift align=center valign=bottom style="font-family: Arial; font-size: 10; color: white">
              COVICA 2020 * Bilder und Zeichnungen BEM'20 * <a href = "impressum.htm">Impressum</a> * <a href ="Datenschutz.htm">Datenschutz</a> <br><br><br><br>
             </td>
             <td></td>
         </tr>
     </table>  
</body>



</head>
</html>
